@model Identity.API.Areas.Admin.ViewModel.UpdateUserRequestViewModel
@{
    ViewData["Title"] = "تعديل المستخدم: " + Model.FirstName + " " + Model.LastName;
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="card">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="fas fa-user-edit"></i> @ViewData["Title"]</h5>
    </div>
    <div class="card-body">
        <form asp-area="Admin" asp-action="Edit" asp-controller="User" method="post">
            <input type="hidden" asp-for="UserId" />

            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle"></i> @TempData["Success"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-circle"></i> @TempData["Error"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

            <div class="row">
                <!-- المعلومات الأساسية -->
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="fas fa-info-circle"></i> المعلومات الأساسية</h6>
                        </div>
                        <div class="card-body">
                            <div class="form-group mb-3">
                                <label asp-for="FirstName" class="form-label"></label>
                                <input asp-for="FirstName" class="form-control" />
                                <span asp-validation-for="FirstName" class="text-danger"></span>
                            </div>

                            <div class="form-group mb-3">
                                <label asp-for="LastName" class="form-label"></label>
                                <input asp-for="LastName" class="form-control" />
                                <span asp-validation-for="LastName" class="text-danger"></span>
                            </div>
                            <div class="form-group mb-3">
                                <label asp-for="CurrentPassword" class="form-label"></label>
                                <input asp-for="CurrentPassword" class="form-control" type="password" />
                                <small class="form-text text-muted">أدخل كلمة المرور الحالية فقط إذا كنت تريد التحقق قبل التحديث</small>
                                <span asp-validation-for="CurrentPassword" class="text-danger"></span>
                            </div>
                      
                        </div>
                    </div>
                </div>

                @* <!-- المعلومات الإضافية -->
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="fas fa-phone"></i> معلومات الاتصال</h6>
                        </div>
                        <div class="card-body">
                            <div class="form-group mb-3">
                                <label asp-for="PhoneNumber" class="form-label"></label>
                                <input asp-for="PhoneNumber" class="form-control" />
                                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                            </div>

                         
                        </div>
                    </div>

                   
                </div> *@
            </div>

            <!-- أزرار الإجراء -->
            <div class="form-group mt-4">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> حفظ التغييرات
                </button>
                <a href="@Url.Action("Index")" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> رجوع للقائمة
                </a>
                <a href="@Url.Action("Details", new { id = Model.UserId })" class="btn btn-info">
                    <i class="fas fa-eye"></i> عرض التفاصيل
                </a>
                @* <a href="@Url.Action("ManageRoles", new { userId = Model.UserId })" class="btn btn-warning">
                    <i class="fas fa-user-shield"></i> إدارة الأدوار
                </a> *@
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function() {
            // إضافة تحسينات للواجهة
            $('.form-control').on('focus', function() {
                $(this).addClass('focus');
            }).on('blur', function() {
                $(this).removeClass('focus');
            });

            // تأكيد قبل الإرسال إذا كانت هناك تغييرات
            $('form').on('submit', function(e) {
                var originalForm = $(this).serialize();
                var currentForm = $(this).clone().find('input[type="password"]').val('').end().serialize();

                if (originalForm === currentForm) {
                    if (!confirm('لم تقم بإجراء أي تغييرات. هل تريد المتابعة؟')) {
                        e.preventDefault();
                    }
                }
            });

            // تحديث عنوان الصفحة مع اسم المستخدم
            var fullName = $('#FirstName').val() + ' ' + $('#LastName').val();
            if (fullName.trim() !== '') {
                document.title = 'تعديل المستخدم: ' + fullName;
            }
        });
    </script>

    <style>
        .form-control.focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        .card-header {
            font-weight: 600;
        }

        .form-check-input:checked {
            background-color: #198754;
            border-color: #198754;
        }
    </style>
}